# Définir les chemins
$MIDFolder = "C:\e-cde\MID"
$PythonExe = "C:\Python311\python.exe"  # Chemin par défaut pour Python 3.11
$MIDFile = Join-Path $MIDFolder "mid.py"
$IconFile = Join-Path $MIDFolder "icon.ico"
$Shortcut = "$env:UserProfile\Desktop\MID.lnk"

# Créer le dossier si inexistant
if (-not (Test-Path $MIDFolder)) { New-Item -ItemType Directory -Path $MIDFolder -Force }

# Télécharger main.txt en mid.py
Invoke-WebRequest -Uri "https://enes-cde.vercel.app/data/MID_MC/main.txt" -OutFile $MIDFile

# Télécharger l'icône
Invoke-WebRequest -Uri "https://enes-cde.vercel.app/data/MID_MC/icon.ico" -OutFile $IconFile

# Installer Python si non trouvé
if (-not (Test-Path $PythonExe)) {
    Write-Host "Python non trouvé, téléchargement en cours..."
    $PythonInstaller = "$env:TEMP\python-installer.exe"
    Invoke-WebRequest -Uri "https://www.python.org/ftp/python/3.12.1/python-3.12.1-amd64.exe" -OutFile $PythonInstaller
    Start-Process -FilePath $PythonInstaller -ArgumentList "/quiet InstallAllUsers=1 PrependPath=1" -Wait
}

# Créer un raccourci sur le bureau
$WshShell = New-Object -ComObject WScript.Shell
$ShortcutObject = $WshShell.CreateShortcut($Shortcut)
$ShortcutObject.TargetPath = $PythonExe
$ShortcutObject.Arguments = "`"$MIDFile`""
$ShortcutObject.IconLocation = $IconFile
$ShortcutObject.Save()

# Exécuter le script mid.py
Start-Process $PythonExe -ArgumentList "`"$MIDFile`""
