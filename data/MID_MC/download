$MIDFolder = "C:\e-cde\MID"
$MIDFile = Join-Path $MIDFolder "mid.py"
$IconFile = Join-Path $MIDFolder "icon.ico"
$Shortcut = Join-Path ([Environment]::GetFolderPath("Desktop")) "MID.lnk"

# --- Création du dossier MID si inexistant ---
if (-not (Test-Path $MIDFolder)) {
    New-Item -ItemType Directory -Path $MIDFolder -Force
}

# --- Téléchargement du fichier main.txt et renommage en mid.py ---
Invoke-WebRequest -Uri "https://enes-cde.vercel.app/data/MID_MC/main.txt" -OutFile $MIDFile

# --- Téléchargement de l'icône ---
Invoke-WebRequest -Uri "https://enes-cde.vercel.app/data/MID_MC/icon.ico" -OutFile $IconFile

# --- Vérification de Python ---
$PythonExe = Get-Command python -ErrorAction SilentlyContinue
if (-not $PythonExe) {
    $PythonExe = Get-Command py -ErrorAction SilentlyContinue
}

if (-not $PythonExe) {
    Write-Host "Python n'est pas installé. Veuillez installer Python avant d'exécuter ce script."
    exit
} else {
    $PythonExe = $PythonExe.Source
}

# --- Création du raccourci sur le bureau ---
$WshShell = New-Object -ComObject WScript.Shell
$ShortcutObject = $WshShell.CreateShortcut($Shortcut)
$ShortcutObject.TargetPath = $PythonExe
$ShortcutObject.Arguments = "`"$MIDFile`""
$ShortcutObject.IconLocation = $IconFile
$ShortcutObject.Save()

# --- Lancement du script Python ---
Start-Process $PythonExe -ArgumentList "`"$MIDFile`""
