<!DOCTYPE html>
    <html lang="fr">
        <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <title>EnesCDE - Admin > Panel Administratif > web manager</title>
        <link rel="icon" type="image/png" href="https://enes-cde.vercel.app/data/img/web/favicon.png">
        
        
        <!-- Script pour ajouter dynamiquement le footer -->
        <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
        <script src="https://enes-cde.vercel.app/script/A-footer.js" defer></script>
        <script src="https://enes-cde.vercel.app/users/panel/admin/__menu__.js" defer></script>
        <script src="https://enes-cde.vercel.app/script/A-all.js" defer></script>
        <script src="./__sessions__.js"></script>
        <div id="ecde_all"></div>

    </head>
    <body class="bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white">
        <div class="flex h-screen">
            <!-- Menu : Deb -->
            <div id="ecde_menu"  class="w-20"></div>
            <!-- Menu : Fin -->
    
            <!-- Main Content -->
            <main class="flex-1 p-6 bg-gray-100 dark:bg-gray-800">
    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Gestion TSL :</h1>


    <br>

                <div class="min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900">
                    <div class="max-w-2xl mx-auto my-8 bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                        <div class="bg-indigo-600 py-6 px-8">
                            <h1 class="text-3xl font-bold text-red text-center"><mark>ATTENTION</mark></h1>
                        </div>
                        <div class="p-8">
                            <p class="text-gray-700 dark:text-gray-300 mb-6">Pour rappel : </p>
                            <p class="text-gray-700 dark:text-gray-300 mb-6">
                                Merci de bien vouloir eviter les :
<br><pre>à - â - ä - é - è - ê - ë - î - ï - ô - ö - ù - û - ü - ÿ - ç</pre>
<br><pre>@, £, $, ¥, è, é, ù, ì, ò, Ç, Ø, ø, Å, å, Δ, _, Φ, Γ, Λ, Ω, Π, Ψ, Σ, Θ, Ξ, Æ, æ, ß, É, !, « , #, ¤, %, &, ', (, ), *, +, ,, -, ., /, :, ;, <, =, >, ?, ¡, Ä, Ö, Ñ, Ü, §, ¿, ä, ö, ñ, ü, àç</pre>
                            </p>
                            <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-4 mb-6">
                                <p class="text-4xl font-bold text-center text-indigo-600"> // </p>
                            </div>
                            <p class="text-gray-700 dark:text-gray-300 mb-6">
                                Eviter <span class="font-semibold"> <u> les caractères speciaux</u></span> empeche une erreur.</p>

                        </div>
                        <div class="bg-gray-100 dark:bg-gray-700 py-4 px-8">
                            <p class="text-sm text-gray-600 dark:text-gray-400 text-center">
                              E - CDE // TSL
                            </p>
                        </div>
                    </div>
                </div>

                



        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <div class="flex flex-col flex-1 w-full rounded-sm transition-colors duration-300 border-black">
        <header class="p-4 flex justify-end">
            <b>ALL</b>
        </header>
        <main class="h-full overflow-y-auto">
            <div class="container px-6 mx-auto grid">
                <h2 class="text-center text-2xl font-bold my-4 text-gray-900 dark:text-gray-200">Statistique</h2>
                <div class="flex items-center justify-center p-4 rounded-lg shadow-md text-gray-800  dark:text-gray-200">
                    <div class="grid lg:grid-cols-3 md:grid-cols-2 gap-6 w-full max-w-6xl">
                        
                        <!-- Tile Blacklist -->
                        <div class="flex items-center p-4 rounded-lg shadow-md bg-gray-300 dark:bg-gray-700">
                            <div class="flex flex-shrink-0 items-center justify-center h-16 w-16 rounded-lg bg-gray-400 dark:bg-gray-600">
                                <i class="bi bi-shield-x text-3xl"></i>
                            </div>
                            <div class="flex-grow flex flex-col ml-4">
                                <span class="text-gray-700 dark:text-gray-400">Blacklist</span>
                                <span class="text-xl font-bold" id="blacklist-count">0</span>
                            </div>
                        </div>
                        
                        <!-- Tile Maintenance -->
                        <div class="flex items-center p-4 rounded-lg shadow-md bg-gray-300 dark:bg-gray-700">
                            <div class="flex flex-shrink-0 items-center justify-center h-16 w-16 rounded-lg bg-gray-400 dark:bg-gray-600">
                                <i class="bi bi-tools text-3xl"></i>
                            </div>
                            <div class="flex-grow flex flex-col ml-4">
                                <span class="text-gray-700 dark:text-gray-400">Maintenance</span>
                                <span class="text-xl font-bold" id="maintenance-count">0</span>
                            </div>
                        </div>
                        
                        <!-- Tile Rappel -->
                        <div class="flex items-center p-4 rounded-lg shadow-md bg-gray-300 dark:bg-gray-700">
                            <div class="flex flex-shrink-0 items-center justify-center h-16 w-16 rounded-lg bg-gray-400 dark:bg-gray-600">
                                <i class="bi bi-bell text-3xl"></i>
                            </div>
                            <div class="flex-grow flex flex-col ml-4">
                                <span class="text-gray-700 dark:text-gray-400">Rappel</span>
                                <span class="text-xl font-bold" id="rappel-count">0</span>
                            </div>
                        </div>
                        <div class="flex items-center p-4 rounded-lg shadow-md bg-gray-300 dark:bg-gray-700">
                            <div class="flex flex-shrink-0 items-center justify-center h-16 w-16 rounded-lg bg-gray-400 dark:bg-gray-600">
                                <i class="bi bi-arrow-left-right text-3xl"></i>
                            </div>
                            <div class="flex-grow flex flex-col ml-4">
                                <span class="text-gray-700 dark:text-gray-400">Redirections</span>
                                <span class="text-xl font-bold" id="redirection-count">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div class="container mx-auto p-4">
        <!-- Table for displaying the sites -->
        <table class="min-w-full table-auto">
            <thead>
                <tr>
                    <th class="px-4 py-2 border dark:border-gray-700">URL</th>
                    <th class="px-4 py-2 border dark:border-gray-700">Type</th>
                    <th class="px-4 py-2 border dark:border-gray-700">Etat</th>
                    <th class="px-4 py-2 border dark:border-gray-700">Actions</th>
                </tr>
            </thead>
            <tbody id="sitesTable">
                <!-- Table rows will be injected here by JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- Popup for managing a site -->
    <div id="managePopup" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex justify-center items-center hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg w-96">
            <h3 class="text-xl font-semibold mb-4">Gérer le Site</h3>
            <div class="mb-4">
                <label for="statut" class="block">Statut</label>
                    <select id="statut" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="blacklist">Blacklist</option>
                        <option value="rappel">Rappel</option>
                        <option value="maintenance">Maintenance</option>
                        <option value="redirection">Redirection</option>
                        <option value="clear">Clear</option>
                    </select>
                    
                    <!-- Dans les extraFields, ajoutez un champ pour l'URL de redirection -->
                    <div id="extraFields" class="mb-4 hidden">
                        <label class="block">Raison</label>
                        <input id="reason" class="w-full p-2 border rounded mb-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white" type="text" placeholder="Ex: Comportement abusif">
                        
                        <!-- Ajoutez ce nouveau champ -->
                        <div id="redirectionUrlField" class="hidden">
                            <label class="block">URL de redirection</label>
                            <input id="redirectionUrl" class="w-full p-2 border rounded mb-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white" type="text" placeholder="Ex: https://nouveau-site.com">
                        </div>
                        
                        <label class="block">Par</label>
                        <input id="by" class="w-full p-2 border rounded mb-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white" type="text" placeholder="Ex: Admin">
                        <label class="block">Date</label>
                        <input id="date" class="w-full p-2 border rounded mb-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white" type="date">
                        <label class="block">Fin (facultatif)</label>
                        <input id="end" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" type="date">
                    </div>
                
                <label for="type" class="block">Type</label>
                <select id="type" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <option value="indefinie">Indéfini</option>
                    <option value="neutre">Neutre</option>
                    <option value="lie">Lié</option>
                    <option value="aff">AFF</option>
                    <option value="officiel">ECDE - Service</option>
                    <option value="sys">ECDE - Système</option>
                    <option value="DL">Developpement local</option>
                    <option value="DE">Developpement externe</option>
                    <option value="DO">Developpement officiel</option>
                    <option value="PG">Preview Git</option>
                    <option value="PV">Preview Vercel</option>
                    <option value="PGB">Preview Git [BOT]</option>
                    <option value="PVB">Preview Vercel [BOT]</option>
                    <option value="TEST">Test</option>
                    <option value="BT">Beta</option>
                    <option value="SDG">Standing</option>
                    <option value="PDT">Production</option>
                    <option value="MTNC">Maintenance</option>
                    <option value="DPCT">Duplication</option>
                    <option value="Disable">Disable</option>
                </select>
            </div>
            <div class="flex justify-end">
                <button id="saveBtn" class="bg-blue-500 text-white py-2 px-4 rounded dark:bg-blue-700">Sauvegarder</button>
                <button id="closeBtn" class="ml-4 py-2 px-4 rounded bg-red-500 text-white dark:bg-red-700">Fermer</button>
            </div>
        </div>
    </div>
    <script>
async function fetchToken() {
    const response = await fetch("https://pkyt-database-up.vercel.app/code-source/E-CDE/Secure-token.js");
    const data = await response.json();
    return data.GITHUB_TOKEN;
}

async function fetchData() {
    const token = await fetchToken();
    const response = await fetch("https://api.github.com/repos/PKYT-Service/database_EnesCDE/contents/ecde/data/ListeAFF.json", {
        headers: {
            Authorization: `token ${token}`
        }
    });
    const data = await response.json();
    const content = atob(data.content);
    const jsonData = JSON.parse(content);

    let blacklistCount = 0;
    let maintenanceCount = 0;
    let rappelCount = 0;
    let redirectionCount = 0;

    jsonData.Sites.forEach(site => {
        if (site.BlackListe.Statut) blacklistCount++;
        if (site.Maintenance.Statut) maintenanceCount++;
        if (site.Rappel.Statut) rappelCount++;
        if (site.Redirection?.Statut) redirectionCount++;
    });

    document.getElementById("blacklist-count").textContent = blacklistCount;
    document.getElementById("maintenance-count").textContent = maintenanceCount;
    document.getElementById("rappel-count").textContent = rappelCount;
    document.getElementById("redirection-count").textContent = redirectionCount;
}

fetchData();
    </script>
    <script>

const tokenUrl = 'https://pkyt-database-up.vercel.app/code-source/E-CDE/Secure-token.js';
const apiUrl = 'https://api.github.com/repos/PKYT-Service/database_EnesCDE/contents/ecde/data/ListeAFF.json';
const tableBody = document.getElementById('sitesTable');
const managePopup = document.getElementById('managePopup');
const closeBtn = document.getElementById('closeBtn');
const saveBtn = document.getElementById('saveBtn');

let currentSite = null;
let jsonData = null;
let sha = null;

async function getGitHubToken() {
    const response = await fetch(tokenUrl);
    const data = await response.json();
    return data.GITHUB_TOKEN;
}

async function fetchData() {
    try {
        const token = await getGitHubToken();
        const response = await fetch(apiUrl, {
            headers: {
                'Authorization': `token ${token}`
            }
        });

        if (!response.ok) throw new Error('Erreur réseau');

        const data = await response.json();
        const fileContent = atob(data.content);
        jsonData = JSON.parse(fileContent);
        sha = data.sha;

        // Initialise Redirection pour tous les sites si non existant
        jsonData.Sites.forEach(site => {
            if (!site.Redirection) {
                site.Redirection = {
                    Statut: false,
                    Raison: "",
                    Url: "",
                    Par: "",
                    Date: "",
                    Fin: ""
                };
            }
        });

        renderTable(jsonData.Sites);
        updateCounters();
    } catch (error) {
        console.error('Erreur fetchData:', error);
        alert('Erreur lors du chargement des données');
    }
}

function updateCounters() {
    let blacklistCount = 0;
    let maintenanceCount = 0;
    let rappelCount = 0;
    let redirectionCount = 0;

    jsonData.Sites.forEach(site => {
        if (site.BlackListe.Statut) blacklistCount++;
        if (site.Maintenance.Statut) maintenanceCount++;
        if (site.Rappel.Statut) rappelCount++;
        if (site.Redirection.Statut) redirectionCount++;
    });

    document.getElementById("blacklist-count").textContent = blacklistCount;
    document.getElementById("maintenance-count").textContent = maintenanceCount;
    document.getElementById("rappel-count").textContent = rappelCount;
    document.getElementById("redirection-count").textContent = redirectionCount;
}

function renderTable(sites) {
    tableBody.innerHTML = '';

    sites.forEach(site => {
        const row = document.createElement('tr');

        // URL
        const urlCell = document.createElement('td');
        urlCell.className = 'px-4 py-2 border dark:border-gray-700';
        urlCell.textContent = site.URL || 'Non défini';

        // Type
        const typeCell = document.createElement('td');
        typeCell.className = 'px-4 py-2 border dark:border-gray-700';
        typeCell.innerHTML = renderTypeTag(site.Type);

        // État
        const stateCell = document.createElement('td');
        stateCell.className = 'px-4 py-2 border dark:border-gray-700';
        stateCell.innerHTML = renderStateTags(site);

        // Actions
        const actionCell = document.createElement('td');
        actionCell.className = 'px-4 py-2 border dark:border-gray-700';
        const manageButton = document.createElement('button');
        manageButton.className = 'bg-green-500 hover:bg-green-600 text-white py-1 px-2 rounded-lg transition';
        manageButton.textContent = 'Gérer';
        manageButton.onclick = () => openManagePopup(site);
        actionCell.appendChild(manageButton);

        row.append(urlCell, typeCell, stateCell, actionCell);
        tableBody.appendChild(row);
    });
}

function renderStateTags(site) {
    const tags = [];

    if (site.BlackListe.Statut) {
        tags.push(`<span class="bg-red-200 hover:bg-red-300 dark:bg-red-700 hover:dark:bg-red-800 py-1 px-2 rounded-lg text-sm">Blacklist</span>`);
    }
    if (site.Maintenance.Statut) {
        tags.push(`<span class="bg-yellow-200 hover:bg-yellow-300 dark:bg-yellow-700 hover:dark:bg-yellow-800 py-1 px-2 rounded-lg text-sm">Maintenance</span>`);
    }
    if (site.Rappel.Statut) {
        tags.push(`<span class="bg-blue-200 hover:bg-blue-300 dark:bg-blue-700 hover:dark:bg-blue-800 py-1 px-2 rounded-lg text-sm">Rappel</span>`);
    }
    if (site.Redirection.Statut) {
        tags.push(`<span class="bg-orange-200 hover:bg-orange-300 dark:bg-orange-700 hover:dark:bg-orange-800 py-1 px-2 rounded-lg text-sm">Redirection</span>`);
    }

    if (tags.length === 0) {
        return `<span class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 hover:dark:bg-gray-800 py-1 px-2 rounded-lg text-sm">Neutre</span>`;
    }
    
    return tags.join(' ');
}

function renderTypeTag(type) {
    const typeClasses = {
        'lie': 'bg-blue-200 dark:bg-blue-700 hover:bg-blue-300 hover:dark:bg-blue-800',
        'aff': 'bg-indigo-200 dark:bg-indigo-700 hover:bg-indigo-300 hover:dark:bg-indigo-800',
        'officiel': 'bg-green-200 dark:bg-green-700 hover:bg-green-300 hover:dark:bg-green-800',
        'sys': 'bg-green-200 dark:bg-green-700 hover:bg-green-300 hover:dark:bg-green-800',
        'DL': 'bg-indigo-200 dark:bg-indigo-700 hover:bg-indigo-300 hover:dark:bg-indigo-800',
        'DE': 'bg-indigo-200 dark:bg-indigo-700 hover:bg-indigo-300 hover:dark:bg-indigo-800',
        'DO': 'bg-indigo-200 dark:bg-indigo-700 hover:bg-indigo-300 hover:dark:bg-indigo-800',
        'PG': 'bg-cyan-200 dark:bg-cyan-700 hover:bg-cyan-300 hover:dark:bg-cyan-800',
        'PV': 'bg-cyan-200 dark:bg-cyan-700 hover:bg-cyan-300 hover:dark:bg-cyan-800',
        'PGB': 'bg-cyan-200 dark:bg-cyan-700 hover:bg-cyan-300 hover:dark:bg-cyan-800',
        'PVB': 'bg-cyan-200 dark:bg-cyan-700 hover:bg-cyan-300 hover:dark:bg-cyan-800',
        'TEST': 'bg-violet-200 dark:bg-violet-700 hover:bg-violet-300 hover:dark:bg-violet-800',
        'BT': 'bg-violet-200 dark:bg-violet-700 hover:bg-violet-300 hover:dark:bg-violet-800',
        'SDG': 'bg-violet-200 dark:bg-violet-700 hover:bg-violet-300 hover:dark:bg-violet-800',
        'PDT': 'bg-violet-200 dark:bg-violet-700 hover:bg-violet-300 hover:dark:bg-violet-800',
        'MTNC': 'bg-yellow-200 dark:bg-yellow-700 hover:bg-yellow-300 hover:dark:bg-yellow-800',
        'indefinie': 'bg-yellow-200 dark:bg-yellow-700 hover:bg-yellow-300 hover:dark:bg-yellow-800',
        'DPCT': 'bg-red-200 dark:bg-red-700 hover:bg-red-300 hover:dark:bg-red-800',
        'Disable': 'bg-red-200 dark:bg-red-700 hover:bg-red-300 hover:dark:bg-red-800',
        'neutre': 'bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 hover:dark:bg-gray-800'
    };

    const classes = typeClasses[type] || 'bg-stone-200 dark:bg-stone-700 hover:bg-stone-300 hover:dark:bg-stone-800';
    const label = {
        'lie': 'Lié',
        'aff': 'AFF',
        'officiel': 'ECDE - Service',
        'sys': 'ECDE - Systeme',
        'DL': 'Dev Local',
        'DE': 'Dev - Externe',
        'DO': 'Dev - Officiel',
        'PG': 'Preview GITHUB',
        'PV': 'Preview Vercel',
        'PGB': 'Preview GITHUB [BOT]',
        'PVB': 'Preview Vercel [BOT]',
        'TEST': 'TEST',
        'BT': 'BETA',
        'SDG': 'Standing',
        'PDT': 'Production',
        'MTNC': 'Maintenance',
        'indefinie': 'Indéfini',
        'DPCT': 'Duplication',
        'Disable': 'Désactivé',
        'neutre': 'Neutre'
    }[type] || 'Neutre';

    return `<span class="${classes} py-1 px-2 rounded-lg text-sm">${label}</span>`;
}

function openManagePopup(site) {
    currentSite = site;
    
    // Initialisation des propriétés si elles n'existent pas
    if (!currentSite.BlackListe) currentSite.BlackListe = { Statut: false, Raison: "", Par: "", Date: "", Fin: "" };
    if (!currentSite.Maintenance) currentSite.Maintenance = { Statut: false, Raison: "", Par: "", Date: "", Fin: "" };
    if (!currentSite.Rappel) currentSite.Rappel = { Statut: false, Raison: "", Par: "", Date: "", Fin: "" };
    if (!currentSite.Redirection) currentSite.Redirection = { Statut: false, Raison: "", Url: "", Par: "", Date: "", Fin: "" };

    // Détermine le statut actuel
    let currentStatus = 'clear';
    const statusPriority = ['blacklist', 'maintenance', 'rappel', 'redirection'];
    
    for (const status of statusPriority) {
        const statusKey = status.charAt(0).toUpperCase() + status.slice(1);
        if (currentSite[statusKey]?.Statut) {
            currentStatus = status;
            break;
        }
    }

    // Remplit les champs du formulaire
    document.getElementById('statut').value = currentStatus;
    document.getElementById('type').value = site.Type || 'indefinie';

    if (currentStatus !== 'clear') {
        const extra = document.getElementById('extraFields');
        extra.classList.remove('hidden');
        
        const redirectionUrlField = document.getElementById('redirectionUrlField');
        redirectionUrlField.classList.toggle('hidden', currentStatus !== 'redirection');

        const statusKey = currentStatus.charAt(0).toUpperCase() + currentStatus.slice(1);
        const activeStatus = currentSite[statusKey] || {};
        
        document.getElementById('reason').value = activeStatus.Raison || '';
        document.getElementById('by').value = activeStatus.Par || '';
        document.getElementById('date').value = activeStatus.Date || '';
        document.getElementById('end').value = activeStatus.Fin || '';
        
        if (currentStatus === 'redirection') {
            document.getElementById('redirectionUrl').value = activeStatus.Url || '';
        }
    }
    
    managePopup.classList.remove('hidden');
}

// Gestion des événements
document.getElementById('statut').addEventListener('change', function() {
    const value = this.value;
    const extra = document.getElementById('extraFields');
    const redirectionUrlField = document.getElementById('redirectionUrlField');
    
    if (['blacklist', 'rappel', 'maintenance', 'redirection'].includes(value)) {
        extra.classList.remove('hidden');
        redirectionUrlField.classList.toggle('hidden', value !== 'redirection');
    } else {
        extra.classList.add('hidden');
    }
});

closeBtn.addEventListener('click', () => managePopup.classList.add('hidden'));

saveBtn.addEventListener('click', async () => {
    try {
        const statut = document.getElementById('statut').value;
        const type = document.getElementById('type').value;
        const reason = document.getElementById('reason').value.trim();
        const by = document.getElementById('by').value.trim();
        const date = document.getElementById('date').value;
        const end = document.getElementById('end').value;
        const redirectionUrl = statut === 'redirection' ? document.getElementById('redirectionUrl').value.trim() : '';

        // Validation des données
        if (['blacklist', 'maintenance', 'rappel', 'redirection'].includes(statut)) {
            if (!reason || !by || !date) {
                throw new Error('Tous les champs obligatoires doivent être remplis');
            }
        }

        // Initialise Redirection si non existant
        if (!currentSite.Redirection) {
            currentSite.Redirection = {
                Statut: false,
                Raison: "",
                Url: "",
                Par: "",
                Date: "",
                Fin: ""
            };
        }

        // Réinitialisation des statuts
        currentSite.BlackListe.Statut = false;
        currentSite.Maintenance.Statut = false;
        currentSite.Rappel.Statut = false;
        currentSite.Redirection.Statut = false;

        // Mise à jour du statut sélectionné
        switch (statut) {
            case 'blacklist':
                currentSite.BlackListe.Statut = true;
                currentSite.BlackListe.Raison = reason;
                currentSite.BlackListe.Par = by;
                currentSite.BlackListe.Date = date;
                currentSite.BlackListe.Fin = end;
                break;
            case 'maintenance':
                currentSite.Maintenance.Statut = true;
                currentSite.Maintenance.Raison = reason;
                currentSite.Maintenance.Par = by;
                currentSite.Maintenance.Date = date;
                currentSite.Maintenance.Fin = end;
                break;
            case 'rappel':
                currentSite.Rappel.Statut = true;
                currentSite.Rappel.Raison = reason;
                currentSite.Rappel.Par = by;
                currentSite.Rappel.Date = date;
                currentSite.Rappel.Fin = end;
                break;
            case 'redirection':
                currentSite.Redirection.Statut = true;
                currentSite.Redirection.Raison = reason;
                currentSite.Redirection.Url = redirectionUrl;
                currentSite.Redirection.Par = by;
                currentSite.Redirection.Date = date;
                currentSite.Redirection.Fin = end;
                break;
        }

        currentSite.Type = type;

        // Envoi des modifications à GitHub
        const updatedData = JSON.stringify(jsonData, null, 2);
        const base64Data = btoa(unescape(encodeURIComponent(updatedData)));
        const token = await getGitHubToken();

        const response = await fetch(apiUrl, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${token}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                message: 'Mise à jour des données de site',
                content: base64Data,
                sha: sha
            })
        });

        if (!response.ok) throw new Error('Erreur GitHub');

        alert('Modifications sauvegardées avec succès!');
        managePopup.classList.add('hidden');
        await fetchData(); // Recharge les données
    } catch (error) {
        console.error('Erreur sauvegarde:', error);
        alert(`Erreur: ${error.message}`);
    }
});

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
    fetchData();
});
        
    </script>


                <!-- Footer : Deb -->
                <div id="ecde_footer"></div>
                <!-- Footer : Fin -->
            </main>
        </div>

        

</body>
</html>

