
<!DOCTYPE html>
    <html lang="fr">
        <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <title>EnesCDE - Admin > Panel Administratif > ClientId manager</title>
        <link rel="icon" type="image/png" href="https://enes-cde.vercel.app/data/img/web/favicon.png">
        
        
        <!-- Script pour ajouter dynamiquement le footer -->
        <script src="https://enes-cde.vercel.app/SLPECDE/main.js" type="module"></script>
        <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
        <script src="https://enes-cde.vercel.app/script/A-footer.js" defer></script>
        <script src="https://enes-cde.vercel.app/users/panel/admin/__menu__.js" defer></script>
        <script src="https://enes-cde.vercel.app/script/A-all.js" defer></script>
        <script src="./__sessions__.js"></script>
        <div id="ecde_all"></div>

    </head>
    <body class="bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white">
        <div class="flex h-screen">
            <!-- Menu : Deb -->
            <div id="ecde_menu"  class="w-20"></div>
            <!-- Menu : Fin -->
    
            <!-- Main Content -->
            <main class="flex-1 p-6 bg-gray-100 dark:bg-gray-800">
    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Admin - Client Id manager :</h1>




    
                
 <div class="max-w-lg mx-auto p-6 bg-white dark:bg-gray-900 shadow-lg rounded-lg">
  <form id="banForm" class="space-y-4">

    <!-- Type de Ban -->
    <div class="flex items-center space-x-4">
      <label for="type" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Type:</label>
      <select id="type" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700">
        <option value="ECDE:ID">ECDE:ID</option>
        <option value="ECDE:ID_IP">ECDE:ID_IP</option>
        <option value="ECDE:ID_RP">ECDE:ID_RP</option>
        <option value="ECDE:ID_DF">ECDE:ID_DF</option>
      </select>
    </div>

    <!-- Valeurs -->
    <div class="flex items-center space-x-4">
      <label for="valeurs" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Valeurs:</label>
      <input type="text" id="valeurs" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700" placeholder="Entrez la valeur" />
    </div>

    <!-- Date -->
    <div class="flex items-center space-x-4">
      <label for="date" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Date:</label>
      <input type="date" id="date" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700" disabled value="" />
    </div>

    <!-- Raison -->
    <div class="flex items-center space-x-4">
      <label for="raison" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Raison:</label>
      <input type="text" id="raison" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700" placeholder="Entrez la raison" />
    </div>

    <!-- Par -->
    <div class="flex items-center space-x-4">
      <label for="par" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Par:</label>
      <input type="text" id="par" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700" placeholder="Défini automatiquement ou vous" />
    </div>

    <!-- Bloquer toutes les accès -->
    <div class="flex items-center space-x-4">
      <label for="bloquer-all" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Bloquer toutes les accès:</label>
      <input type="checkbox" id="bloquer-all" class="p-2" />
    </div>

    <!-- Bloquer sur certaines URL -->
    <div class="flex items-center space-x-4">
      <label for="web-url" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Bloquer sur URL:</label>
      <input type="text" id="web-url" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700" placeholder="Entrez une URL" />
      <button type="button" id="add-url" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Ajouter</button>
    </div>

    <ul id="url-list" class="list-disc ml-8 mt-2 text-gray-800 dark:text-gray-200">
      <!-- URLs bloquées ajoutées ici -->
    </ul>

    <!-- Actions -->
    <div class="flex justify-between space-x-4">
      <button type="button" id="add" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Ajouter</button>
      <button type="button" id="modify" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Modifier</button>
    </div>
  </form>

  <!-- Liste des bannissements existants -->
  <div class="mt-6">
    <h2 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-100">Bannissements Existants</h2>
    <ul id="ban-list" class="space-y-4 text-gray-800 dark:text-gray-200">
      <!-- Les entrées seront ajoutées ici -->
    </ul>
  </div>
 </div>
<script defer>
// Initialise la date d'aujourd'hui
document.getElementById('date').value = new Date().toISOString().split('T')[0];

// Variables
let urls = [];
let banData = [];

// Ajouter une URL
document.getElementById('add-url').addEventListener('click', () => {
  const urlInput = document.getElementById('web-url').value;
  if (urlInput && !urls.includes(urlInput)) {
    urls.push(urlInput);
    document.getElementById('web-url').value = '';
    updateUrlList();
  }
});

function updateUrlList() {
  const urlList = document.getElementById('url-list');
  urlList.innerHTML = '';
  urls.forEach(url => {
    const li = document.createElement('li');
    li.textContent = url;
    urlList.appendChild(li);
  });
}

// Récupération du token depuis Tocken.js
async function getGitHubToken() {
  const response = await fetch('https://pkyt-database-up.vercel.app/code-source/E-CDE/Secure-token.js');
  const data = await response.json();
  return data.GITHUB_TOKEN;
}

// Récupération du SHA du fichier
async function getFileSha() {
  const token = await getGitHubToken();
  const res = await fetch('https://api.github.com/repos/PKYT-Service/database_EnesCDE/contents/ecde/data/BanECDE:ID.json', {
    headers: {
      'Authorization': `token ${token}`
    }
  });
  if (!res.ok) return null;
  const data = await res.json();
  return data.sha;
}

// Sauvegarde les données modifiées sur GitHub
async function saveToGitHub(data) {
  const token = await getGitHubToken();
  const sha = await getFileSha();
  const res = await fetch('https://api.github.com/repos/PKYT-Service/database_EnesCDE/contents/ecde/data/BanECDE:ID.json', {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      message: 'Mise à jour BanECDE:ID.json',
      content: btoa(JSON.stringify(data, null, 2)),
      sha: sha
    })
  });

  if (!res.ok) {
    const err = await res.json();
    alert(`Erreur GitHub: ${err.message}`);
  } else {
    alert('Données sauvegardées sur GitHub');
    loadBanData();
  }
}

// Charger les données existantes
async function loadBanData() {
  const token = await getGitHubToken();
  const res = await fetch('https://api.github.com/repos/PKYT-Service/database_EnesCDE/contents/ecde/data/BanECDE:ID.json', {
    headers: {
      'Authorization': `token ${token}`
    }
  });
  if (!res.ok) return;

  const file = await res.json();
  banData = JSON.parse(atob(file.content));
  renderList();
}

// Affiche la liste
function renderList() {
  const container = document.getElementById('ban-list');
  container.innerHTML = '';

  banData.forEach((entry, index) => {
    const card = document.createElement('div');
    card.className = "bg-gray-50  dark:bg-gray-950  p-4 border rounded shadow mb-4";

    card.innerHTML = `
      <p><strong>Type:</strong> ${entry.Type}</p>
      <p><strong>Valeurs:</strong> ${entry.Valeurs}</p>
      <p><strong>Raison:</strong> ${entry.Raison}</p>
      <p><strong>Date:</strong> ${entry.Date}</p>
      <p><strong>Par:</strong> ${entry.Par}</p>
      <p><strong>Bloqué (All):</strong> ${entry.bloque.All}</p>
      <p><strong>URLs:</strong> ${entry.bloque.web_url.join(', ')}</p>
      <div class="flex space-x-2 mt-2">
        <button onclick="editEntry(${index})" class="bg-yellow-400 text-white px-2 py-1 rounded">Modifier</button>
        <button onclick="removeEntry(${index})" class="bg-red-500 text-white px-2 py-1 rounded">Supprimer</button>
      </div>
    `;
    container.appendChild(card);
  });
}

// Ajouter une entrée
document.getElementById('add').addEventListener('click', () => {
  const type = document.getElementById('type').value;
  const valeurs = document.getElementById('valeurs').value;
  const date = document.getElementById('date').value;
  const par = document.getElementById('par').value || 'Admin';
  const raison = document.getElementById('raison').value || 'Non précisé';
  const bloqueAll = document.getElementById('bloquer-all').checked;

  const newEntry = {
    Type: type,
    Valeurs: valeurs,
    Raison: raison,
    Date: date,
    Par: par,
    bloque: {
      All: bloqueAll,
      web: bloqueAll,
      web_url: urls,
    },
  };

  banData.push(newEntry);
  saveToGitHub(banData);
});

// Supprimer une entrée
async function removeEntry(index) {
  if (!confirm("Tu es sûr de vouloir supprimer cette entrée ?")) return;
  banData.splice(index, 1);
  await saveToGitHub(banData);
}

// Modifier une entrée (préremplissage)
window.editEntry = function(index) {
  const entry = banData[index];
  document.getElementById('type').value = entry.Type;
  document.getElementById('valeurs').value = entry.Valeurs;
  document.getElementById('date').value = entry.Date;
  document.getElementById('raison').value = entry.Raison;
  document.getElementById('par').value = entry.Par;
  document.getElementById('bloquer-all').checked = entry.bloque.All;
  urls = [...entry.bloque.web_url];
  updateUrlList();

  // Réenregistrement remplacera l’entrée existante
  document.getElementById('modify').onclick = () => {
    banData[index] = {
      Type: document.getElementById('type').value,
      Valeurs: document.getElementById('valeurs').value,
      Raison: document.getElementById('raison').value || 'Non précisé',
      Date: document.getElementById('date').value,
      Par: document.getElementById('par').value || 'Admin',
      bloque: {
        All: document.getElementById('bloquer-all').checked,
        web: document.getElementById('bloquer-all').checked,
        web_url: [...urls],
      },
    };
    saveToGitHub(banData);
  };
};

// Chargement initial
window.addEventListener('DOMContentLoaded', loadBanData);
</script>

                <!-- Footer : Deb -->
                <div id="ecde_footer"></div>
                <!-- Footer : Fin -->
            </main>
        </div>

        

</body>
    </html>
