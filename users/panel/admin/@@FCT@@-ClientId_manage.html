
<!DOCTYPE html>
    <html lang="fr">
        <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <title>EnesCDE - Admin > Panel Administratif > ClientId manager</title>
        <link rel="icon" type="image/png" href="https://enes-cde.vercel.app/data/img/web/favicon.png">
        
        
        <!-- Script pour ajouter dynamiquement le footer -->
        <script src="https://enes-cde.vercel.app/SLPECDE/main.js" type="module"></script>
        <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
        <script src="https://enes-cde.vercel.app/script/A-footer.js" defer></script>
        <script src="https://enes-cde.vercel.app/users/panel/admin/__menu__.js" defer></script>
        <script src="https://enes-cde.vercel.app/script/A-all.js" defer></script>
        <script src="./__sessions__.js"></script>
        <div id="ecde_all"></div>

    </head>
    <body class="bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white">
        <div class="flex h-screen">
            <!-- Menu : Deb -->
            <div id="ecde_menu"  class="w-20"></div>
            <!-- Menu : Fin -->
    
            <!-- Main Content -->
            <main class="flex-1 p-6 bg-gray-100 dark:bg-gray-800">
    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Admin - Client Id manager :</h1>




    
                
 <div class="max-w-lg mx-auto p-6 bg-white dark:bg-gray-900 shadow-lg rounded-lg">
  <form id="banForm" class="space-y-4">

    <!-- Type de Ban -->
    <div class="flex items-center space-x-4">
      <label for="type" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Type:</label>
      <select id="type" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700">
        <option value="ECDE:ID">ECDE:ID</option>
        <option value="ECDE:ID_IP">ECDE:ID_IP</option>
        <option value="ECDE:ID_RP">ECDE:ID_RP</option>
        <option value="ECDE:ID_DF">ECDE:ID_DF</option>
      </select>
    </div>

    <!-- Valeurs -->
    <div class="flex items-center space-x-4">
      <label for="valeurs" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Valeurs:</label>
      <input type="text" id="valeurs" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700" placeholder="Entrez la valeur" />
    </div>

    <!-- Date -->
    <div class="flex items-center space-x-4">
      <label for="date" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Date:</label>
      <input type="date" id="date" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700" disabled value="" />
    </div>

    <!-- Raison -->
    <div class="flex items-center space-x-4">
      <label for="raison" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Raison:</label>
      <input type="text" id="raison" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700" placeholder="Entrez la raison" />
    </div>

    <!-- Par -->
    <div class="flex items-center space-x-4">
      <label for="par" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Par:</label>
      <input type="text" id="par" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700" placeholder="Défini automatiquement ou vous" />
    </div>

    <!-- Bloquer toutes les accès -->
    <div class="flex items-center space-x-4">
      <label for="bloquer-all" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Bloquer toutes les accès:</label>
      <input type="checkbox" id="bloquer-all" class="p-2" />
    </div>

    <!-- Bloquer sur certaines URL -->
    <div class="flex items-center space-x-4">
      <label for="web-url" class="w-1/3 font-semibold text-gray-800 dark:text-gray-200">Bloquer sur URL:</label>
      <input type="text" id="web-url" class="p-2 border rounded-md w-2/3 bg-white dark:bg-gray-800 dark:text-white dark:border-gray-700" placeholder="Entrez une URL" />
      <button type="button" id="add-url" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Ajouter</button>
    </div>

    <ul id="url-list" class="list-disc ml-8 mt-2 text-gray-800 dark:text-gray-200">
      <!-- URLs bloquées ajoutées ici -->
    </ul>

    <!-- Actions -->
    <div class="flex justify-between space-x-4">
      <button type="button" id="add" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Ajouter</button>
      <button type="button" id="modify" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Modifier</button>
    </div>
  </form>

  <!-- Liste des bannissements existants -->
  <div class="mt-6">
    <h2 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-100">Bannissements Existants</h2>
    <ul id="ban-list" class="space-y-4 text-gray-800 dark:text-gray-200">
      <!-- Les entrées seront ajoutées ici -->
    </ul>
  </div>
 </div>
<script defer>
// Initialise la date d'aujourd'hui
document.getElementById('date').value = new Date().toISOString().split('T')[0];

// Variables
let urls = [];
let banData = [];

// Ajouter une URL
document.getElementById('add-url').addEventListener('click', () => {
  const urlInput = document.getElementById('web-url').value;
  if (urlInput && !urls.includes(urlInput)) {
    urls.push(urlInput);
    document.getElementById('web-url').value = '';
    updateUrlList();
  }
});

function updateUrlList() {
  const urlList = document.getElementById('url-list');
  urlList.innerHTML = '';
  urls.forEach(url => {
    const li = document.createElement('li');
    li.textContent = url;
    urlList.appendChild(li);
  });
}

// Récupération du token depuis Tocken.js
async function getGitHubToken() {
  const response = await fetch('https://pkyt-database-up.vercel.app/code-source/E-CDE/Secure-token.js');
  const data = await response.json();
  return data.GITHUB_TOKEN;
}

// Récupération du SHA du fichier
async function getFileSha() {
  const token = await getGitHubToken();
  const res = await fetch('https://api.github.com/repos/PKYT-Service/database_EnesCDE/contents/ecde/data/BanECDE:ID.json', {
    headers: {
      'Authorization': `token ${token}`
    }
  });
  if (!res.ok) return null;
  const data = await res.json();
  return data.sha;
}

// Sauvegarde les données modifiées sur GitHub
async function saveToGitHub(data) {
  const token = await getGitHubToken();
  const sha = await getFileSha();
  const res = await fetch('https://api.github.com/repos/PKYT-Service/database_EnesCDE/contents/ecde/data/BanECDE:ID.json', {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      message: 'Mise à jour BanECDE:ID.json',
      content: btoa(JSON.stringify(data, null, 2)),
      sha: sha
    })
  });

  if (!res.ok) {
    const err = await res.json();
    alert(`Erreur GitHub: ${err.message}`);
  } else {
    alert('Données sauvegardées sur GitHub');
    loadBanData();
  }
}

// Charger les données existantes depuis GitHub
async function loadBanData() {
  const token = await getGitHubToken();

  try {
    const res = await fetch('https://api.github.com/repos/PKYT-Service/database_EnesCDE/contents/ecde/data/BanECDE:ID.json', {
      headers: {
        'Authorization': `token ${token}`
      }
    });

    if (!res.ok) {
      console.warn('❌ Erreur lors du chargement du fichier GitHub.');
      banData = []; // Fallback par défaut
      renderList();
      return;
    }

    const file = await res.json();

    // Vérification si le fichier a un contenu valide
    if (!file.content) {
      console.warn('❌ Le fichier est vide ou son contenu est manquant.');
      banData = []; // Si le contenu est vide ou manquant
      renderList();
      return;
    }

    // Si le fichier n'est pas encodé en base64
    if (file.encoding !== 'base64') {
      console.log('✅ Le fichier n\'est pas encodé en base64, récupération directe du contenu.');
      const decoded = file.content;
      try {
        // Parse le JSON, gère les chaînes vides
        banData = JSON.parse(decoded);
        if (!Array.isArray(banData)) {
          console.warn("⚠️ Structure inattendue, banData doit être un tableau. Utilisation d'une liste vide.");
          banData = [];
        }
      } catch (parseError) {
        console.error("❌ Erreur de parsing JSON :", parseError);
        banData = [];
      }
    } else {
      // Si le fichier est encodé en base64, on le décode
      const decoded = atob(file.content || "");
      if (!decoded.trim()) {
        console.warn('⚠️ Contenu vide, initialisation d\'une liste vide.');
        banData = [];
      } else {
        try {
          // Parser et vérifier la structure du JSON
          banData = JSON.parse(decoded);
          if (!Array.isArray(banData)) {
            console.warn("⚠️ Structure inattendue après décodage base64. Utilisation d'une liste vide.");
            banData = [];
          }
        } catch (error) {
          console.error('❌ Erreur de parsing après décodage base64 :', error);
          banData = [];
        }
      }
    }

    renderList(); // Affiche les données dans l'interface utilisateur

  } catch (error) {
    console.error("❌ Erreur générale lors de la récupération des données :", error);
    banData = []; // Initialisation d'un tableau vide en cas d'erreur
    renderList();
  }
}

// Fonction pour afficher les données bannies
function renderList() {
  const listElement = document.getElementById('ban-list');
  listElement.innerHTML = ''; // Réinitialiser la liste

  if (banData.length === 0) {
    listElement.innerHTML = '<li>Aucune donnée disponible</li>';
  } else {
    banData.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item ? item : 'Valeur vide'; // Gestion des valeurs vides
      listElement.appendChild(li);
    });
  }
}

// Appel initial pour charger les données
loadBanData();
</script>



                <!-- Footer : Deb -->
                <div id="ecde_footer"></div>
                <!-- Footer : Fin -->
            </main>
        </div>

        

</body>
    </html>
